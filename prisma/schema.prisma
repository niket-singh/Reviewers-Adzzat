// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  REVIEWER
  CONTRIBUTOR
}

enum TaskStatus {
  PENDING      // Submitted by contributor
  CLAIMED      // Claimed by reviewer
  ELIGIBLE     // Marked eligible by reviewer (Blue)
  APPROVED     // Approved by admin (Green)
  REJECTED     // Rejected
}

model User {
  id                String       @id @default(cuid())
  email             String       @unique
  password          String
  name              String
  role              UserRole     @default(CONTRIBUTOR)
  isApproved        Boolean      @default(false)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  submissions       Submission[] @relation("ContributorSubmissions")
  claimedSubmissions Submission[] @relation("ClaimedSubmissions")
  reviews           Review[]

  @@index([email])
  @@index([role])
}

model Submission {
  id            String      @id @default(cuid())
  title         String
  domain        String
  language      String
  fileUrl       String
  fileName      String
  status        TaskStatus  @default(PENDING)
  claimedById   String?
  claimedBy     User?       @relation("ClaimedSubmissions", fields: [claimedById], references: [id])
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  contributorId String
  contributor   User        @relation("ContributorSubmissions", fields: [contributorId], references: [id])
  reviews       Review[]

  @@index([contributorId])
  @@index([status])
  @@index([createdAt])
  @@index([claimedById])
}

model Review {
  id              String      @id @default(cuid())
  feedback        String      @db.Text
  accountPostedIn String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  submissionId    String
  submission      Submission  @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  reviewerId      String
  reviewer        User        @relation(fields: [reviewerId], references: [id])

  @@index([submissionId])
  @@index([reviewerId])
}
