// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  REVIEWER
  CONTRIBUTOR
}

enum TaskStatus {
  PENDING      // Submitted by contributor
  CLAIMED      // Claimed by reviewer
  ELIGIBLE     // Marked eligible by reviewer (Blue)
  APPROVED     // Approved by admin (Green)
  REJECTED     // Rejected
}

model User {
  id            String      @id @default(cuid())
  email         String      @unique
  password      String      // Hashed
  name          String
  role          UserRole    @default(CONTRIBUTOR)
  isApproved    Boolean     @default(false) // For reviewers waiting admin approval
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  submissions   Submission[]
  reviews       Review[]

  @@index([email])
  @@index([role])
}

model Submission {
  id            String      @id @default(cuid())
  title         String
  domain        String      // Text field for task domain
  language      String      // Text field for programming language
  fileUrl       String      // R2 storage URL
  fileName      String      // Original file name
  status        TaskStatus  @default(PENDING)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  contributorId String
  contributor   User        @relation(fields: [contributorId], references: [id])
  reviews       Review[]

  @@index([contributorId])
  @@index([status])
  @@index([createdAt])
}

model Review {
  id            String      @id @default(cuid())
  feedback      String      @db.Text
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  submissionId  String
  submission    Submission  @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  reviewerId    String
  reviewer      User        @relation(fields: [reviewerId], references: [id])

  @@index([submissionId])
  @@index([reviewerId])
}
